{"id":"6783184","content":"package ch.qos.logback.core.joran.action;\n\nimport ch.qos.logback.core.hook.ShutdownHookBase;\nimport ch.qos.logback.core.joran.spi.ActionException;\nimport ch.qos.logback.core.joran.spi.InterpretationContext;\nimport ch.qos.logback.core.util.OptionHelper;\nimport org.xml.sax.Attributes;\n\npublic class ShutdownHookAction extends Action {\n   ShutdownHookBase hook;\n   private boolean inError;\n\n   public void begin(InterpretationContext ic, String name, Attributes attributes) throws ActionException {\n      this.hook = null;\n      this.inError = false;\n      String className = attributes.getValue(\"class\");\n      if (OptionHelper.isEmpty(className)) {\n         this.addError(\"Missing class name for shutdown hook. Near [\" + name + \"] line \" + this.getLineNumber(ic));\n         this.inError = true;\n      } else {\n         try {\n            this.addInfo(\"About to instantiate shutdown hook of type [\" + className + \"]\");\n            this.hook = (ShutdownHookBase)OptionHelper.instantiateByClassName(className, ShutdownHookBase.class, this.context);\n            this.hook.setContext(this.context);\n            ic.pushObject(this.hook);\n         } catch (Exception var6) {\n            this.inError = true;\n            this.addError(\"Could not create a shutdown hook of type [\" + className + \"].\", var6);\n            throw new ActionException(var6);\n         }\n      }\n   }\n\n   public void end(InterpretationContext ic, String name) throws ActionException {\n      if (!this.inError) {\n         Object o = ic.peekObject();\n         if (o != this.hook) {\n            this.addWarn(\"The object at the of the stack is not the hook pushed earlier.\");\n         } else {\n            ic.popObject();\n            Thread hookThread = new Thread(this.hook, \"Logback shutdown hook [\" + this.context.getName() + \"]\");\n            this.context.putObject(\"SHUTDOWN_HOOK\", hookThread);\n            Runtime.getRuntime().addShutdownHook(hookThread);\n         }\n\n      }\n   }\n}\n"}