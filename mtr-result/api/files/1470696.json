{"id":"1470696","content":"package org.springframework.aop.aspectj.annotation;\n\nimport java.io.Serializable;\nimport org.springframework.lang.Nullable;\nimport org.springframework.util.Assert;\n\npublic class LazySingletonAspectInstanceFactoryDecorator implements MetadataAwareAspectInstanceFactory, Serializable {\n   private final MetadataAwareAspectInstanceFactory maaif;\n   @Nullable\n   private volatile Object materialized;\n\n   public LazySingletonAspectInstanceFactoryDecorator(MetadataAwareAspectInstanceFactory maaif) {\n      Assert.notNull(maaif, \"AspectInstanceFactory must not be null\");\n      this.maaif = maaif;\n   }\n\n   public Object getAspectInstance() {\n      Object aspectInstance = this.materialized;\n      if (aspectInstance == null) {\n         Object mutex = this.maaif.getAspectCreationMutex();\n         if (mutex == null) {\n            aspectInstance = this.maaif.getAspectInstance();\n            this.materialized = aspectInstance;\n         } else {\n            synchronized(mutex) {\n               aspectInstance = this.materialized;\n               if (aspectInstance == null) {\n                  aspectInstance = this.maaif.getAspectInstance();\n                  this.materialized = aspectInstance;\n               }\n            }\n         }\n      }\n\n      return aspectInstance;\n   }\n\n   public boolean isMaterialized() {\n      return this.materialized != null;\n   }\n\n   @Nullable\n   public ClassLoader getAspectClassLoader() {\n      return this.maaif.getAspectClassLoader();\n   }\n\n   public AspectMetadata getAspectMetadata() {\n      return this.maaif.getAspectMetadata();\n   }\n\n   @Nullable\n   public Object getAspectCreationMutex() {\n      return this.maaif.getAspectCreationMutex();\n   }\n\n   public int getOrder() {\n      return this.maaif.getOrder();\n   }\n\n   public String toString() {\n      return \"LazySingletonAspectInstanceFactoryDecorator: decorating \" + this.maaif;\n   }\n}\n"}