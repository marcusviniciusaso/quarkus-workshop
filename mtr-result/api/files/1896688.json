{"id":"1896688","content":"package ch.qos.logback.classic.helpers;\n\nimport java.io.IOException;\nimport javax.servlet.Filter;\nimport javax.servlet.FilterChain;\nimport javax.servlet.FilterConfig;\nimport javax.servlet.ServletException;\nimport javax.servlet.ServletRequest;\nimport javax.servlet.ServletResponse;\nimport javax.servlet.http.HttpServletRequest;\nimport org.slf4j.MDC;\n\npublic class MDCInsertingServletFilter implements Filter {\n   public void destroy() {\n   }\n\n   public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException {\n      this.insertIntoMDC(request);\n\n      try {\n         chain.doFilter(request, response);\n      } finally {\n         this.clearMDC();\n      }\n\n   }\n\n   void insertIntoMDC(ServletRequest request) {\n      MDC.put(\"req.remoteHost\", request.getRemoteHost());\n      if (request instanceof HttpServletRequest) {\n         HttpServletRequest httpServletRequest = (HttpServletRequest)request;\n         MDC.put(\"req.requestURI\", httpServletRequest.getRequestURI());\n         StringBuffer requestURL = httpServletRequest.getRequestURL();\n         if (requestURL != null) {\n            MDC.put(\"req.requestURL\", requestURL.toString());\n         }\n\n         MDC.put(\"req.method\", httpServletRequest.getMethod());\n         MDC.put(\"req.queryString\", httpServletRequest.getQueryString());\n         MDC.put(\"req.userAgent\", httpServletRequest.getHeader(\"User-Agent\"));\n         MDC.put(\"req.xForwardedFor\", httpServletRequest.getHeader(\"X-Forwarded-For\"));\n      }\n\n   }\n\n   void clearMDC() {\n      MDC.remove(\"req.remoteHost\");\n      MDC.remove(\"req.requestURI\");\n      MDC.remove(\"req.queryString\");\n      MDC.remove(\"req.requestURL\");\n      MDC.remove(\"req.method\");\n      MDC.remove(\"req.userAgent\");\n      MDC.remove(\"req.xForwardedFor\");\n   }\n\n   public void init(FilterConfig arg0) throws ServletException {\n   }\n}\n"}